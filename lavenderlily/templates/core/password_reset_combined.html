{% extends "base.html" %}
{% load static %}
{% block title %}Forgot Password{% endblock %}

{% block content %}

<style>
    /* Layout */
    .llreset-container {
        display: flex;
        min-height: 90vh;
        margin-top: 30px;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    .llreset-left {
        flex: 1;
        padding: 60px;
        background: #fff;
        display: none;
    }
    .llreset-active { display: block !important; }

    .llreset-title {
        font-family: "Playfair Display", serif;
        font-size: 40px;
        margin-bottom: 10px;
        color: #2d2d2d;
    }

    .llreset-sub {
        font-size: 16px;
        color: #666;
        margin-bottom: 25px;
    }

    .llreset-input {
        width: 100%;
        padding: 14px 16px;
        border-radius: 12px;
        border: 1.3px solid #ddd;
        margin-bottom: 15px;
        transition: 0.3s;
    }

    .llreset-input:focus {
        border-color: #b38adf;
        box-shadow: 0 0 0 2px rgba(179, 138, 223, 0.3);
    }

    .llreset-btn {
        background: #b38adf;
        color: white;
        width: 100%;
        padding: 14px;
        font-size: 16px;
        border: none;
        border-radius: 12px;
        margin-top: 10px;
        transition: 0.3s;
    }

    .llreset-btn:hover {
        background: #9c6dd9;
    }

    /* Right Side Panel */
    .llreset-right {
        flex: 1;
        background-image: url('https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=1600&q=80');
        background-size: cover;
        background-position: center;
        position: relative;
    }

    .llreset-overlay {
        position: absolute;
        inset: 0;
        background: rgba(78, 43, 104, 0.45);
    }

    .llreset-text-block {
        position: absolute;
        bottom: 40px;
        left: 40px;
        color: white;
        max-width: 350px;
    }

    .llreset-text-block h2 {
        font-family: "Playfair Display", serif;
        font-size: 36px;
    }

    .llreset-text-block p {
        font-size: 16px;
        line-height: 1.6;
        opacity: 0.9;
    }
</style>



<div class="container">
    <div class="llreset-container">

        <!-- LEFT SIDE — Dynamic Steps -->
        
        <!-- STEP 1: Enter Email -->
        <div id="stepRequest" class="llreset-left">
            <h1 class="llreset-title">Forgot Password?</h1>
            <p class="llreset-sub">Enter your email and we’ll send a reset link.</p>

            <form method="POST" action="{% url 'password_reset' %}">
                {% csrf_token %}
                {{ form.as_p }}
                <button class="llreset-btn">Send Reset Link</button>
            </form>

            <p class="mt-3">
                <a href="{% url 'signin' %}">Back to Sign In</a>
            </p>
        </div>


        <!-- STEP 2: Email Sent -->
        <div id="stepSent" class="llreset-left">
            <h1 class="llreset-title">Email Sent</h1>
            <p class="llreset-sub">
                Check your inbox for instructions to reset your password.
            </p>
        </div>


        <!-- STEP 3: New Password Form -->
        <div id="stepResetForm" class="llreset-left">
            {% if validlink %}
                <h1 class="llreset-title">Set New Password</h1>
                <p class="llreset-sub">Enter your new secure password.</p>

                <form method="POST">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button class="llreset-btn">Reset Password</button>
                </form>

            {% else %}
                <h1 class="llreset-title">Invalid Link</h1>
                <p class="llreset-sub">This password reset link is invalid or expired.</p>
            {% endif %}
        </div>


        <!-- STEP 4: Done -->
        <div id="stepComplete" class="llreset-left">
            <h1 class="llreset-title">Password Changed</h1>
            <p class="llreset-sub">
                Your password has been successfully reset.
            </p>
            <a href="{% url 'signin' %}" class="llreset-btn text-center"
                style="display: inline-block; text-decoration:none;">
                Continue to Sign In
            </a>
        </div>


        <!-- RIGHT SIDE IMAGE PANEL -->
        <div class="llreset-right">
            <div class="llreset-overlay"></div>

            <div class="llreset-text-block">
                <h2>Lavender Dreams</h2>
                <p>
                    Your journey to elegance begins again. Reset your password and step 
                    back into a world of curated fashion and timeless designs.
                </p>
            </div>
        </div>

    </div>
</div>



<script>
    const url = window.location.href;

    if (url.includes("forgot-password")) {
        document.getElementById("stepRequest").classList.add("llreset-active");
    }
    else if (url.includes("password-reset-sent")) {
        document.getElementById("stepSent").classList.add("llreset-active");
    }
    else if (url.includes("reset/") && !url.includes("done")) {
        document.getElementById("stepResetForm").classList.add("llreset-active");
    }
    else if (url.includes("reset/done")) {
        document.getElementById("stepComplete").classList.add("llreset-active");
    }
</script>

{% endblock %}
