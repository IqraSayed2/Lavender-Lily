{% extends "base.html" %}
{% load static %}
{% block title %}Complete Payment{% endblock %}

{% block content %}

<!-- Payment Section -->
<section class="payment-page-section">
  <div class="container">
    <div class="row">
      <!-- Header -->
      <div class="col-12">
        <div class="payment-page-header">
          <div class="text-center">
            <h1 class="payment-page-title">Complete Your Payment</h1>
            <p class="payment-results-count">
              Secure demo payment processing
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">

        <!-- Order Items Card -->
        <div class="payment-page-form-card">
          <div class="payment-page-card-header">
            <h2 class="payment-page-section-title">
              <i class="fas fa-list me-2"></i>
              Order Items
            </h2>
          </div>

          <div class="payment-order-items">
            {% for item in order.items.all %}
            <div class="payment-item">
              <div class="payment-item-image">
                {% if item.product.image_main %}
                  <img src="{{ item.product.image_main.url }}" alt="{{ item.product.name }}" class="payment-item-img">
                {% else %}
                  <div class="payment-item-placeholder">
                    <i class="fas fa-image"></i>
                  </div>
                {% endif %}
              </div>
              <div class="payment-item-details">
                <h6 class="payment-item-name">{{ item.product.name }}</h6>
                <p class="payment-item-meta">Quantity: {{ item.quantity }}</p>
                <p class="payment-item-price">{{ item.price|floatformat:2 }} {{ currency }} each</p>
              </div>
              <div class="payment-item-total">
                <span class="payment-item-total-price">{{ item.subtotal|floatformat:2 }} {{ currency }}</span>
              </div>
            </div>
            {% endfor %}
          </div>

          <!-- Order Totals -->
          <div class="payment-totals">
            <div class="payment-total-row">
              <span class="payment-total-label">Subtotal:</span>
              <span class="payment-total-value">{{ subtotal|floatformat:2 }} {{ currency }}</span>
            </div>
            <div class="payment-total-row">
              <span class="payment-total-label">Shipping:</span>
              <span class="payment-total-value">{{ shipping|floatformat:2 }} {{ currency }}</span>
            </div>
            <div class="payment-total-row">
              <span class="payment-total-label">Tax (5% VAT):</span>
              <span class="payment-total-value">{{ tax|floatformat:2 }} {{ currency }}</span>
            </div>
            <div class="payment-total-row payment-grand-total">
              <span class="payment-total-label">Total Amount:</span>
              <span class="payment-total-value">{{ order.total_amount|floatformat:2 }} {{ currency }}</span>
            </div>
          </div>
        </div>

          <div class="row">
            <div class="col-md-6">
              <div class="payment-order-info">
                <h5 class="payment-info-title">Order Details</h5>
                <div class="payment-info-item">
                  <span class="payment-label">Order Number:</span>
                  <span class="payment-value">{{ order.order_number }}</span>
                </div>
                <div class="payment-info-item">
                  <span class="payment-label">Total Amount:</span>
                  <span class="payment-value payment-amount">{{ order.total_amount|floatformat:2 }} {{ currency }}</span>
                </div>
                <div class="payment-info-item">
                  <span class="payment-label">Customer:</span>
                  <span class="payment-value">{{ user.first_name }} {{ user.last_name }}</span>
                </div>
                <div class="payment-info-item">
                  <span class="payment-label">Email:</span>
                  <span class="payment-value">{{ user.email }}</span>
                </div>
                <div class="payment-info-item">
                  <span class="payment-label">Phone:</span>
                  <span class="payment-value">{{ customer_phone|default:"Not provided" }}</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="payment-method-info">
                <h5 class="payment-info-title">Payment Method</h5>
                <div class="payment-method-card">
                  <div class="payment-method-icon">
                    <i class="fas fa-credit-card"></i>
                  </div>
                  <div class="llpayment-method-details">
                    <h6 class="llpayment-method-name">
                      Fake Payment
                    </h6>
                    <p class="payment-method-desc">
                      Demo payment processing
                    </p>
                    <div class="payment-security-badges">
                      <span class="payment-badge">
                        <i class="fas fa-shield-alt"></i> Demo Mode
                      </span>
                      <span class="payment-badge">
                        <i class="fas fa-check"></i> Always Success
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Action Card -->
        <div class="payment-page-amt-card">
          <div class="payment-page-card-header">
            <h2 class="payment-page-section-title">
              <i class="fas fa-credit-card me-2"></i>
              Payment Details
            </h2>
          </div>
          <div class="text-center">
            <div class="payment-action-content">
              <div class="payment-amount-display">
                <span class="payment-amount-label">Amount to Pay</span>
                <div class="payment-amount-value">{{ order.total_amount|floatformat:2 }} {{ currency }}</div>
              </div>

              <div class="payment-form">
                <button id="rzp-button1" class="payment-pay-btn">
                  <i class="fas fa-credit-card me-2"></i>
                  Pay {{ order.total_amount|floatformat:2 }} {{ currency }}
                </button>
              </div>

              <div class="payment-notice">
                <i class="fas fa-info-circle me-1"></i>
                This is a demo payment system - clicking pay will simulate successful payment
              </div>

              <div class="payment-security-notice">
                <i class="fas fa-check me-1"></i>
                Demo mode: Payment will always succeed
              </div>
            </div>
          </div>
        </div>

        <!-- Back to Checkout -->
        <div class="text-center mt-5">
          <a href="{% url 'checkout' %}" class="payment-back-link">
            <i class="fas fa-arrow-left"></i> Back to Checkout
          </a>
        </div>

      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('rzp-button1').onclick = function(e) {
        e.preventDefault();

        // Show loading state
        const button = document.getElementById('rzp-button1');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing Payment...';
        button.disabled = true;

        // Simulate payment processing delay
        setTimeout(function() {
            // Create form to submit payment
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ callback_url }}';

            // Add CSRF token
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = document.querySelector('[name=csrfmiddlewaretoken]').value;
            form.appendChild(csrfInput);

            // Add order number
            const orderInput = document.createElement('input');
            orderInput.type = 'hidden';
            orderInput.name = 'order_number';
            orderInput.value = '{{ order.order_number }}';
            form.appendChild(orderInput);

            document.body.appendChild(form);
            form.submit();
        }, 2000); // 2 second delay to simulate processing
    };
});
</script>

{% endblock %}